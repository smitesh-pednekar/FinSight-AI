# FinSight AI - System Architecture

## ğŸ“ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER BROWSER                            â”‚
â”‚                      (http://localhost:3000)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP/REST
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NEXT.JS FRONTEND (web)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Pages: Home | Upload | Documents | Search | Alerts      â”‚  â”‚
â”‚  â”‚  Components: File Upload | Document Cards | Status       â”‚  â”‚
â”‚  â”‚  API Client: Type-safe fetch wrapper                     â”‚  â”‚
â”‚  â”‚  Styling: Tailwind CSS + shadcn/ui                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ REST API Calls
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FASTAPI BACKEND (api)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Routes Layer                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ /documents: Upload, List, Get, Retry, Delete        â”‚  â”‚
â”‚  â”‚  â”œâ”€ /search: Semantic search                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ /alerts: Risk flag management                       â”‚  â”‚
â”‚  â”‚  â””â”€ /reports: Report generation                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Processing Pipeline (Async)                            â”‚  â”‚
â”‚  â”‚  1. Text Extraction (PDF/DOCX/OCR)                      â”‚  â”‚
â”‚  â”‚  2. Document Classification (AI)                        â”‚  â”‚
â”‚  â”‚  3. Financial Data Extraction (AI + Structured)         â”‚  â”‚
â”‚  â”‚  4. Validation (Code-based)                             â”‚  â”‚
â”‚  â”‚  5. Risk Detection (Rules + AI explanations)            â”‚  â”‚
â”‚  â”‚  6. Embedding Generation (Vector search)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                         â”‚                      â”‚
          â”‚                         â”‚                      â”‚
          â–¼                         â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   POSTGRESQL     â”‚   â”‚   OPENAI API         â”‚   â”‚  FILE        â”‚
â”‚   + pgvector     â”‚   â”‚                      â”‚   â”‚  STORAGE     â”‚
â”‚                  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚              â”‚
â”‚  Tables:         â”‚   â”‚  â”‚ GPT-4 Turbo    â”‚  â”‚   â”‚  /uploads/   â”‚
â”‚  â”œâ”€ users        â”‚   â”‚  â”‚ (Extraction &  â”‚  â”‚   â”‚              â”‚
â”‚  â”œâ”€ documents    â”‚   â”‚  â”‚  Classification)â”‚  â”‚   â”‚  *.pdf       â”‚
â”‚  â”œâ”€ extractions  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  *.docx      â”‚
â”‚  â”œâ”€ validations  â”‚   â”‚                      â”‚   â”‚  *.png       â”‚
â”‚  â”œâ”€ risk_flags   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚              â”‚
â”‚  â”œâ”€ chunks       â”‚   â”‚  â”‚ text-embedding â”‚  â”‚   â”‚              â”‚
â”‚  â”‚  (vector)     â”‚   â”‚  â”‚ -3-small       â”‚  â”‚   â”‚              â”‚
â”‚  â””â”€ audit_logs   â”‚   â”‚  â”‚ (Search)       â”‚  â”‚   â”‚              â”‚
â”‚                  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Document Processing Flow

```
User Upload
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. UPLOAD HANDLER                      â”‚
â”‚ â”œâ”€ Validate file type                  â”‚
â”‚ â”œâ”€ Check file size                     â”‚
â”‚ â”œâ”€ Save to disk                        â”‚
â”‚ â”œâ”€ Create DB record (UPLOADED)         â”‚
â”‚ â””â”€ Return document ID immediately      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ (Background Task)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. TEXT EXTRACTION                     â”‚
â”‚ â”œâ”€ PDF: pypdf reader                   â”‚
â”‚ â”œâ”€ DOCX: python-docx                   â”‚
â”‚ â”œâ”€ Images: tesseract OCR               â”‚
â”‚ â””â”€ Store extracted text                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. CLASSIFICATION (AI)                 â”‚
â”‚ â”œâ”€ Send text to GPT-4                  â”‚
â”‚ â”œâ”€ Classify document type              â”‚
â”‚ â”‚  (Invoice, Bank Statement, P&L, etc) â”‚
â”‚ â””â”€ Update document_type                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. EXTRACTION (AI)                     â”‚
â”‚ â”œâ”€ Use type-specific schema            â”‚
â”‚ â”œâ”€ Prompt GPT-4 with strict JSON       â”‚
â”‚ â”œâ”€ Parse structured data               â”‚
â”‚ â”‚  (vendor, amounts, dates, items)     â”‚
â”‚ â””â”€ Store in financial_extractions      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. VALIDATION (CODE-BASED)             â”‚
â”‚ â”œâ”€ Invoice validations:                â”‚
â”‚ â”‚  â”œâ”€ Total = Subtotal + Tax           â”‚
â”‚ â”‚  â”œâ”€ Line items sum                   â”‚
â”‚ â”‚  â”œâ”€ Tax calculation                  â”‚
â”‚ â”‚  â”œâ”€ Required fields                  â”‚
â”‚ â”‚  â”œâ”€ Date logic                       â”‚
â”‚ â”‚  â””â”€ No negatives                     â”‚
â”‚ â””â”€ Store in financial_validations      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. RISK DETECTION (RULES)              â”‚
â”‚ â”œâ”€ High-value transaction check        â”‚
â”‚ â”œâ”€ Unusual payment terms               â”‚
â”‚ â”œâ”€ Round number anomalies              â”‚
â”‚ â”œâ”€ Missing tax info                    â”‚
â”‚ â”œâ”€ Convert validation failures         â”‚
â”‚ â”œâ”€ Generate AI explanations            â”‚
â”‚ â””â”€ Store in risk_flags                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. EMBEDDING GENERATION                â”‚
â”‚ â”œâ”€ Split text into chunks              â”‚
â”‚ â”œâ”€ Generate embeddings (OpenAI)        â”‚
â”‚ â”œâ”€ Store vectors in document_chunks    â”‚
â”‚ â””â”€ Enable semantic search              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. COMPLETION                          â”‚
â”‚ â”œâ”€ Update status: COMPLETED            â”‚
â”‚ â”œâ”€ Set completion timestamp            â”‚
â”‚ â””â”€ User can view all results           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database Schema Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      users         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) PK       â”‚
â”‚ email (unique)     â”‚
â”‚ hashed_password    â”‚
â”‚ full_name          â”‚
â”‚ is_active          â”‚
â”‚ created_at         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ 1:N
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       documents            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) PK               â”‚
â”‚ user_id (FK)               â”‚
â”‚ filename                   â”‚
â”‚ file_path                  â”‚
â”‚ file_size                  â”‚
â”‚ status (ENUM)              â”‚
â”‚ document_type (ENUM)       â”‚
â”‚ extracted_text (TEXT)      â”‚
â”‚ page_count                 â”‚
â”‚ processing_started_at      â”‚
â”‚ processing_completed_at    â”‚
â”‚ error_message              â”‚
â”‚ retry_count                â”‚
â”‚ created_at                 â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚   â”‚   â”‚   â”‚   â”‚
     â”‚   â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚   â”‚   â”‚                    â”‚
     â”‚   â”‚   â”‚   â”‚                    â–¼
     â”‚   â”‚   â”‚   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚   â”‚   â”‚         â”‚    audit_logs        â”‚
     â”‚   â”‚   â”‚   â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚   â”‚   â”‚   â”‚         â”‚ id (UUID) PK         â”‚
     â”‚   â”‚   â”‚   â”‚         â”‚ user_id (FK)         â”‚
     â”‚   â”‚   â”‚   â”‚         â”‚ document_id (FK)     â”‚
     â”‚   â”‚   â”‚   â”‚         â”‚ action               â”‚
     â”‚   â”‚   â”‚   â”‚         â”‚ resource_type        â”‚
     â”‚   â”‚   â”‚   â”‚         â”‚ changes (JSONB)      â”‚
     â”‚   â”‚   â”‚   â”‚         â”‚ created_at           â”‚
     â”‚   â”‚   â”‚   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚   â”‚   â”‚   â”‚
     â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚   â”‚                    â–¼
     â”‚   â”‚   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚   â”‚         â”‚   document_chunks        â”‚
     â”‚   â”‚   â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚   â”‚   â”‚         â”‚ id (UUID) PK             â”‚
     â”‚   â”‚   â”‚         â”‚ document_id (FK)         â”‚
     â”‚   â”‚   â”‚         â”‚ chunk_text (TEXT)        â”‚
     â”‚   â”‚   â”‚         â”‚ chunk_index (INT)        â”‚
     â”‚   â”‚   â”‚         â”‚ embedding (vector[1536]) â”‚â—„â”€â”€ pgvector
     â”‚   â”‚   â”‚         â”‚ metadata (JSONB)         â”‚
     â”‚   â”‚   â”‚         â”‚ created_at               â”‚
     â”‚   â”‚   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚   â”‚   â”‚
     â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚                    â–¼
     â”‚   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚         â”‚     risk_flags           â”‚
     â”‚   â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚   â”‚         â”‚ id (UUID) PK             â”‚
     â”‚   â”‚         â”‚ document_id (FK)         â”‚
     â”‚   â”‚         â”‚ risk_type                â”‚
     â”‚   â”‚         â”‚ risk_level (ENUM)        â”‚
     â”‚   â”‚         â”‚ description              â”‚
     â”‚   â”‚         â”‚ ai_explanation (TEXT)    â”‚â—„â”€â”€ AI-generated
     â”‚   â”‚         â”‚ evidence (JSONB)         â”‚
     â”‚   â”‚         â”‚ is_resolved (BOOL)       â”‚
     â”‚   â”‚         â”‚ resolution_notes         â”‚
     â”‚   â”‚         â”‚ created_at               â”‚
     â”‚   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚   â”‚
     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                    â–¼
     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         â”‚  financial_validations       â”‚
     â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚         â”‚ id (UUID) PK                 â”‚
     â”‚         â”‚ document_id (FK)             â”‚
     â”‚         â”‚ validation_type              â”‚
     â”‚         â”‚ is_valid (BOOL)              â”‚â—„â”€â”€ Code-based
     â”‚         â”‚ expected_value (JSONB)       â”‚
     â”‚         â”‚ actual_value (JSONB)         â”‚
     â”‚         â”‚ error_message                â”‚
     â”‚         â”‚ severity (ENUM)              â”‚
     â”‚         â”‚ created_at                   â”‚
     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  financial_extractions       â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚ id (UUID) PK                 â”‚
           â”‚ document_id (FK)             â”‚
           â”‚ extracted_data (JSONB)       â”‚â—„â”€â”€ Flexible schema
           â”‚ confidence_score (FLOAT)     â”‚
           â”‚ invoice_number               â”‚
           â”‚ invoice_date                 â”‚
           â”‚ vendor_name                  â”‚
           â”‚ subtotal                     â”‚
           â”‚ tax_amount                   â”‚
           â”‚ total_amount                 â”‚
           â”‚ currency                     â”‚
           â”‚ created_at                   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           SECURITY LAYERS              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  1. Input Validation                   â”‚
â”‚     â”œâ”€ Pydantic schemas                â”‚
â”‚     â”œâ”€ File type whitelist             â”‚
â”‚     â”œâ”€ File size limits                â”‚
â”‚     â””â”€ Request body validation         â”‚
â”‚                                        â”‚
â”‚  2. Database Security                  â”‚
â”‚     â”œâ”€ Parameterized queries (ORM)     â”‚
â”‚     â”œâ”€ No raw SQL                      â”‚
â”‚     â”œâ”€ Connection pooling              â”‚
â”‚     â””â”€ Transaction management          â”‚
â”‚                                        â”‚
â”‚  3. API Security                       â”‚
â”‚     â”œâ”€ CORS configuration              â”‚
â”‚     â”œâ”€ Environment secrets             â”‚
â”‚     â”œâ”€ Error sanitization              â”‚
â”‚     â””â”€ Rate limiting (TODO)            â”‚
â”‚                                        â”‚
â”‚  4. Data Security                      â”‚
â”‚     â”œâ”€ File path validation            â”‚
â”‚     â”œâ”€ UUID for all IDs                â”‚
â”‚     â”œâ”€ Audit logging                   â”‚
â”‚     â””â”€ Cascade delete                  â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Diagram

```
Upload File
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   REST API      â”‚
â”‚   (FastAPI)     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â–º Save File â”€â”€â”€â”€â”€â”€â”€â”€â–º /uploads/uuid.pdf
     â”‚
     â”œâ”€â”€â”€â”€â–º Create Record â”€â”€â”€â”€â–º documents table (UPLOADED)
     â”‚
     â”œâ”€â”€â”€â”€â–º Background Task â”€â”€â–º process_document(id)
     â”‚
     â””â”€â”€â”€â”€â–º Return Response â”€â”€â–º {id, status: "UPLOADED"}

Background Task:
    â”‚
    â”œâ”€â”€â”€â”€â–º Extract Text â”€â”€â”€â”€â”€â”€â–º extracted_text field
    â”‚
    â”œâ”€â”€â”€â”€â–º Classify â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º GPT-4 â”€â”€â–º INVOICE
    â”‚
    â”œâ”€â”€â”€â”€â–º Extract Data â”€â”€â”€â”€â”€â–º GPT-4 â”€â”€â–º financial_extractions (JSONB)
    â”‚
    â”œâ”€â”€â”€â”€â–º Validate â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Python â”€â”€â–º financial_validations
    â”‚
    â”œâ”€â”€â”€â”€â–º Detect Risks â”€â”€â”€â”€â”€â–º Rules â”€â”€â–º risk_flags
    â”‚                                 â”‚
    â”‚                                 â””â”€â”€â–º GPT-4 (explanations only)
    â”‚
    â”œâ”€â”€â”€â”€â–º Generate Embeddings â”€â”€â–º OpenAI â”€â”€â–º document_chunks (vectors)
    â”‚
    â””â”€â”€â”€â”€â–º Update Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º COMPLETED
```

---

## ğŸ”„ API Request Flow

```
Frontend Request
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. API Client (TypeScript)        â”‚
â”‚     â”œâ”€ Type-safe parameters        â”‚
â”‚     â”œâ”€ Error handling              â”‚
â”‚     â””â”€ JSON serialization          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ HTTP POST/GET
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. FastAPI Route Handler          â”‚
â”‚     â”œâ”€ Request validation          â”‚
â”‚     â”œâ”€ Dependency injection        â”‚
â”‚     â””â”€ Database session            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Service Layer                  â”‚
â”‚     â”œâ”€ Business logic              â”‚
â”‚     â”œâ”€ AI calls                    â”‚
â”‚     â””â”€ Validations                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Database (Async)               â”‚
â”‚     â”œâ”€ SQLAlchemy ORM              â”‚
â”‚     â”œâ”€ Transactions                â”‚
â”‚     â””â”€ Eager loading               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Response (JSON)                â”‚
â”‚     â”œâ”€ Pydantic serialization      â”‚
â”‚     â”œâ”€ Status codes                â”‚
â”‚     â””â”€ Error messages              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**FinSight AI Architecture v1.0**
Production-Grade Financial Document Intelligence
